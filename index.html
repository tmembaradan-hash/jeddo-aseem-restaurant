<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø·Ø¹Ù… Ø¬Ø¯Ùˆ Ø¹Ø§ØµÙ… - Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="icon" type="image/png" href="logo-jeddo-aseem.png">

  <style>
    :root {
      /* Ø£Ù„ÙˆØ§Ù† Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ù„ÙˆÙ† Ø§Ù„Ø´Ø¹Ø§Ø± */
      --primary-dark: #8a2d0b;      /* Ø¨Ù†ÙŠ ØºØ§Ù…Ù‚ (Ù…Ø«Ù„ Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø¹Ø§Ø±) */
      --primary: #c6511c;           /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ØºØ§Ù…Ù‚ Ù„Ù„Ø²Ø± ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… */
      --bg: #f5e6d7;                /* Ø¨ÙŠØ¬ ÙØ§ØªØ­ Ù„Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© */
      --card: #ffffff;
      --radius: 14px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Cairo", system-ui, sans-serif;
      background: var(--bg);
      color: #222;
      font-size: 16px; /* Ø­ØªÙ‰ Ù„Ø§ ÙŠØ­ØµÙ„ Ø²ÙˆÙ… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
    }

    header {
      background: linear-gradient(135deg, #c56226, var(--primary-dark));
      color: #fff;
      padding: 10px 12px 8px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    .header-inner {
      max-width: 960px;
      margin: 0 auto;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .header-logo {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      object-fit: cover;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
      background: #fff;
    }

    .header-text h1 {
      margin: 0;
      font-size: 1.45rem;
    }

    .header-text p {
      margin: 2px 0 0;
      font-size: 0.85rem;
      opacity: 0.96;
    }

    .nav-tabs {
      display: flex;
      margin-top: 10px;
      background: rgba(0,0,0,0.22);
      border-radius: 999px;
      padding: 3px;
    }

    .nav-tab {
      flex: 1;
      text-align: center;
      padding: 7px 4px;
      font-size: 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      color: #fbe0c9;
      user-select: none;
      transition: background 0.15s, color 0.15s, transform 0.1s;
    }

    .nav-tab:hover {
      transform: translateY(-1px);
    }

    .nav-tab.active {
      background: #fff;
      color: var(--primary-dark);
      font-weight: 600;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 12px;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(6px);}
      to {opacity: 1; transform: translateY(0);}
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù… */
    .menu-controls {
      display: flex;
      gap: 8px;
      margin: 10px 0;
      flex-wrap: wrap;
    }

    .menu-controls input,
    .menu-controls select {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #c9b19b;
      font-family: inherit;
      font-size: 1rem; /* 16px Ù„Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… */
      flex: 1;
      min-width: 120px;
      background: #fffaf5;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 10px;
    }

    .menu-item {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .menu-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    .menu-img {
      height: 110px;
      background-size: cover;
      background-position: center;
      background-color: #e2b18a;
    }

    .menu-content {
      padding: 8px 10px 10px;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .menu-item h3 {
      margin: 0;
      font-size: 0.95rem;
    }

    .menu-category {
      font-size: 0.75rem;
      color: #7c5e4a;
      margin-top: 2px;
    }

    .menu-tags {
      font-size: 0.7rem;
      color: #555;
      margin-top: 4px;
    }

    .menu-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .menu-price {
      color: var(--primary);
      font-weight: bold;
      font-size: 0.9rem;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 11px;
      font-size: 0.9rem;
      cursor: pointer;
      font-family: inherit;
      transition: transform 0.1s, box-shadow 0.1s, background 0.15s;
    }

    .btn:active {
      transform: scale(0.96);
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.18);
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid #ddd;
    }

    /* Ø§Ù„Ø³Ù„Ø© */
    .two-cols {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 10px;
    }

    @media (max-width: 720px) {
      .two-cols {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      padding: 12px;
      font-size: 0.9rem;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 1rem;
      color: var(--primary-dark);
    }

    .cart-empty {
      color: #777;
      font-size: 0.85rem;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 0.87rem;
    }

    .cart-item-controls button {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
      font-size: 0.85rem;
    }

    .cart-total {
      margin-top: 8px;
      font-weight: bold;
      text-align: left;
      color: var(--primary-dark);
    }

    /* Ø§Ù‡ØªØ²Ø§Ø² Ø§Ù„Ø³Ù„Ø© */
    .cart-bump {
      animation: cartShake 0.35s ease;
    }

    @keyframes cartShake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      50% { transform: translateX(3px); }
      75% { transform: translateX(-2px); }
      100% { transform: translateX(0); }
    }

    .checkout-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .checkout-grid label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 2px;
    }

    .checkout-grid input,
    .checkout-grid select,
    .checkout-grid textarea {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #c9b19b;
      font-family: inherit;
      font-size: 1rem; /* 16px Ù„Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… */
      background: #fffdf8;
    }

    .checkout-grid textarea {
      min-height: 60px;
      grid-column: 1 / span 2;
    }

    .status-message {
      margin-top: 8px;
      font-size: 0.8rem;
    }

    .status-message.success {
      color: #0a7e2a;
    }

    .status-message.error {
      color: #b00020;
    }

    /* ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ */
    .track-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 0.9rem;
    }

    .track-form label {
      font-size: 0.8rem;
    }

    .track-form input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #c9b19b;
      font-size: 1rem; /* 16px Ù„Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… */
      background: #fffdf8;
    }

    .track-result {
      margin-top: 8px;
      font-size: 0.85rem;
    }

    .track-card {
      padding: 8px;
      border-radius: 10px;
      background: #fff7ee;
      border: 1px solid #f1d0aa;
      margin-bottom: 6px;
    }

    .track-status {
      font-weight: 600;
      color: var(--primary-dark);
    }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
    .admin-login {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      gap: 6px;
      align-items: center;
      margin-bottom: 10px;
    }

    .admin-login input {
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid #c9b19b;
      font-family: inherit;
      font-size: 1rem; /* 16px Ù„Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… */
      background: #fffdf8;
    }

    .admin-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
      font-size: 0.8rem;
    }

    .admin-filters select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #c9b19b;
      font-family: inherit;
      font-size: 0.9rem;
      background: #fffdf8;
    }

    .admin-orders {
      max-height: 380px;
      overflow-y: auto;
      font-size: 0.8rem;
    }

    .admin-order {
      border-radius: 12px;
      background: #fff7f1;
      border: 1px solid #f0d0b3;
      padding: 8px;
      margin-bottom: 8px;
    }

    .admin-order-header {
      display: flex;
      justify-content: space-between;
      gap: 6px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .admin-badge {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      color: #fff;
    }

    .badge-new { background: #00796b; }
    .badge-preparing { background: #ffa000; }
    .badge-ready { background: #1976d2; }
    .badge-done { background: #388e3c; }

    .admin-order-body-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 2px;
    }

    .admin-order-body-row span.label {
      font-weight: 600;
    }

    .admin-order-footer {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: space-between;
    }

    .admin-order-footer select {
      padding: 3px 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.75rem;
    }

    /* AI Assistant */
    .ai-button {
      position: fixed;
      bottom: 16px;
      left: 16px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 54px;
      height: 54px;
      font-size: 1.6rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .ai-panel {
      position: fixed;
      bottom: 80px;
      left: 16px;
      width: 260px;
      max-height: 360px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.35);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 998;
    }

    .ai-panel.open {
      display: flex;
      animation: fadeIn 0.2s ease-out;
    }

    .ai-header {
      background: var(--primary-dark);
      color: #fff;
      padding: 8px;
      font-size: 0.8rem;
    }

    .ai-body {
      padding: 8px;
      font-size: 0.78rem;
      overflow-y: auto;
      max-height: 260px;
    }

    .ai-msg {
      margin-bottom: 6px;
    }

    .ai-msg.user {
      text-align: right;
    }

    .ai-msg.bot {
      text-align: left;
    }

    .ai-footer {
      padding: 6px;
      border-top: 1px solid #eee;
      display: flex;
      gap: 4px;
    }

    .ai-footer input {
      flex: 1;
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.85rem;
    }

    .ai-footer button {
      padding: 4px 8px;
      border-radius: 6px;
      border: none;
      font-size: 0.78rem;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
    }

    .ai-suggestion {
      display: inline-block;
      background: #f1f1f1;
      border-radius: 999px;
      padding: 3px 7px;
      margin-top: 3px;
      cursor: pointer;
    }

    /* ØªØ°ÙŠÙŠÙ„ Ø¨Ø³ÙŠØ· */
    .footer {
      max-width: 960px;
      margin: 8px auto 16px;
      text-align: center;
      font-size: 0.72rem;
      color: #777;
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-top">
      <img src="logo-jeddo-aseem.png" alt="Ù…Ø·Ø¹Ù… Ø¬Ø¯Ùˆ Ø¹Ø§ØµÙ…" class="header-logo">
      <div class="header-text">
        <h1>Ù…Ø·Ø¹Ù… Ø¬Ø¯Ùˆ Ø¹Ø§ØµÙ…</h1>
        <p>Ø§Ø·Ù„Ø¨ Ø£ÙƒÙ„ÙÙƒ Ø¨Ø³Ø±Ø¹Ø©â€¦ ÙˆØ®Ù„ÙŠ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ù„ÙŠÙ†Ø§ ğŸ˜‹</p>
      </div>
    </div>

    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="orderTab">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</div>
      <div class="nav-tab" data-tab="trackTab">ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨</div>
      <div class="nav-tab" data-tab="adminTab">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
    </div>
  </div>
</header>

<div class="container">

  <!-- ØªØ¨ÙˆÙŠØ¨ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ -->
  <section id="orderTab" class="active">
    <div class="two-cols">

      <div>
        <div class="card">
          <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø¹Ø§Ù…</h2>
          <div class="menu-controls">
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø¨Ù‚ (Ø´Ø§ÙˆØ±Ù…Ø§ØŒ Ø¨Ø±ØºØ±ØŒ Ø¨Ø·Ø§Ø·Ø§...)">
            <select id="categoryFilter">
              <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
            </select>
          </div>
          <div id="menu" class="menu-grid"></div>
        </div>
      </div>

      <div>
        <div class="card" id="cartCard">
          <h2>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
          <div id="cart-content"></div>
          <div class="cart-total" id="cart-total"></div>
        </div>

        <div class="card" style="margin-top:10px;">
          <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</h2>
          <div class="checkout-grid">
            <div>
              <label>Ø§Ù„Ø§Ø³Ù…</label>
              <input type="text" id="customerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
            </div>
            <div>
              <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
              <input type="tel" id="phone" placeholder="09xxxxxxxx">
            </div>
            <div>
              <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
              <input type="text" id="address" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© - Ø§Ù„Ø­ÙŠ - Ø§Ù„ØªÙØ§ØµÙŠÙ„">
            </div>
            <div>
              <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
              <select id="delivery">
                <option value="delivery">ØªÙˆØµÙŠÙ„</option>
                <option value="pickup">Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø·Ø¹Ù…</option>
              </select>
            </div>
            <div>
              <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
              <textarea id="notes" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ Ø²ÙŠØ§Ø¯Ø© Ø«ÙˆÙ…ØŒ ..."></textarea>
            </div>
          </div>
          <button class="btn btn-primary" id="submitOrderBtn" style="margin-top:8px; width:100%;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
          <div id="status" class="status-message"></div>
        </div>
      </div>

    </div>
  </section>

  <!-- ØªØ¨ÙˆÙŠØ¨ ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ -->
  <section id="trackTab">
    <div class="card">
      <h2>ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
      <div class="track-form">
        <div>
          <label>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input type="text" id="trackOrderId" placeholder="Ù…Ø«Ø§Ù„: ORD-...">
        </div>
        <div>
          <label>Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</label>
          <input type="tel" id="trackPhone" placeholder="09xxxxxxxx">
        </div>
      </div>
      <button class="btn btn-primary" id="trackBtn">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©</button>
      <div id="trackResult" class="track-result"></div>
    </div>
  </section>

  <!-- ØªØ¨ÙˆÙŠØ¨ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
  <section id="adminTab">
    <div class="card">
      <h2>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
      <div class="admin-login">
        <input type="password" id="adminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">
        <button class="btn btn-primary" id="adminLoginBtn">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div class="admin-filters">
        <span>ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©:</span>
        <select id="adminStatusFilter">
          <option value="ALL">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
          <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±">Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
          <option value="Ø¬Ø§Ù‡Ø²">Ø¬Ø§Ù‡Ø²</option>
          <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
        </select>
      </div>
      <div id="adminStatus" class="status-message"></div>
      <div id="adminOrders" class="admin-orders"></div>
    </div>
  </section>

</div>

<div class="footer">
  Ù…Ø·Ø¹Ù… Ø¬Ø¯Ùˆ Ø¹Ø§ØµÙ… Â© 2025 â€” ØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ø¨Ø±Ø¯Ø§Ù† Â· 0957482415
</div>

<!-- Ø²Ø± Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ -->
<button class="ai-button" id="aiButton">ğŸ¤–</button>

<div class="ai-panel" id="aiPanel">
  <div class="ai-header">
    Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø°ÙƒÙŠ
  </div>
  <div class="ai-body" id="aiBody">
    <div class="ai-msg bot">Ø£Ù‡Ù„Ø§Ù‹ ğŸ‘‹ ØµÙ Ù„ÙŠ Ù…Ø²Ø§Ø¬Ùƒ (Ø­Ø§Ø±ØŒ Ø±Ø®ÙŠØµØŒ Ø³Ø±ÙŠØ¹ØŒ Ø¨Ø¯ÙˆÙ† Ø¯Ø¬Ø§Ø¬...) ÙˆØ£Ù†Ø§ Ø£Ø®ØªØ§Ø± Ù„Ùƒ ğŸ˜‰</div>
  </div>
  <div class="ai-footer">
    <input type="text" id="aiInput" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø¯ÙŠ Ø´ÙŠ Ø³Ø±ÙŠØ¹ ÙˆØ±Ø®ÙŠØµ">
    <button id="aiSendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script>
  // Ø±Ø§Ø¨Ø· Web App Ù…Ù† Apps Script (Ø§Ù„Ø¹Ø§Ù…ÙÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹)
const API_URL = "https://script.google.com/macros/s/AKfycbwoLTzrfjvEf0siwpYuASaLiyYOvpub_5Yy0vtIia53VaX145ohQ0yH5XXecBl-RPQpCg/exec";

  let MENU = [];
  let CART = [];
  let ADMIN_TOKEN = '';
  let ADMIN_ORDERS = []; // ÙƒØ§Ø´ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©

  /*********** Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ***********/
  function escapeHtml_(str) {
    return (str || '').toString()
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;');
  }

  function formatDateTime_(val) {
    if (!val) return '';
    const d = new Date(val);
    if (isNaN(d.getTime())) return val;
    return d.toLocaleString('ar-SY');
  }

  /*********** ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ***********/
  document.querySelectorAll('.nav-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      const target = tab.dataset.tab;
      document.querySelectorAll('section').forEach(sec => {
        sec.classList.toggle('active', sec.id === target);
      });
    });
  });

  /*********** ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ÙŠÙˆ ***********/
  async function loadMenu() {
    try {
      const res = await fetch(API_URL + '?action=getMenu');
      const data = await res.json();
      if (!data.success) throw new Error(data.error || 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©');
      MENU = data.menu || [];
      fillCategoryFilter();
      renderMenu();
    } catch (err) {
      document.getElementById('menu').innerHTML =
        '<div>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: ' + escapeHtml_(err.message) + '</div>';
    }
  }

  function fillCategoryFilter() {
    const cats = [...new Set(MENU.map(m => m.category).filter(Boolean))];
    const select = document.getElementById('categoryFilter');
    cats.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      select.appendChild(opt);
    });
  }

  function renderMenu() {
    const menuDiv = document.getElementById('menu');
    menuDiv.innerHTML = '';
    const search = document.getElementById('searchInput').value.trim().toLowerCase();
    const cat = document.getElementById('categoryFilter').value;

    let items = MENU;
    if (search) {
      items = items.filter(m =>
        m.name.toLowerCase().includes(search) ||
        (m.tags || '').toLowerCase().includes(search)
      );
    }
    if (cat) {
      items = items.filter(m => m.category === cat);
    }

    if (!items.length) {
      menuDiv.innerHTML = '<div>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ØµÙ†Ø§Ù Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«.</div>';
      return;
    }

    items.forEach(item => {
      const card = document.createElement('div');
      card.className = 'menu-item';

      const imgDiv = document.createElement('div');
      imgDiv.className = 'menu-img';
      if (item.image_url) {
        imgDiv.style.backgroundImage = `url("${item.image_url}")`;
      } else {
        imgDiv.style.backgroundImage =
          'linear-gradient(135deg, #e6b089, #f9dcc3)';
      }

      const content = document.createElement('div');
      content.className = 'menu-content';

      let tagsHtml = '';
      if (item.tags) {
        tagsHtml = '<div class="menu-tags">' + escapeHtml_(item.tags) + '</div>';
      }

      content.innerHTML = `
        <div>
          <h3>${escapeHtml_(item.name)}</h3>
          <div class="menu-category">${escapeHtml_(item.category || '')}</div>
          ${tagsHtml}
        </div>
        <div class="menu-footer">
          <div class="menu-price">${item.price} Ù„.Ø³</div>
          <button class="btn btn-primary" data-id="${item.id}">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      `;

      content.querySelector('button').addEventListener('click', () => addToCart(item.id));

      card.appendChild(imgDiv);
      card.appendChild(content);
      menuDiv.appendChild(card);
    });
  }

  document.getElementById('searchInput').addEventListener('input', renderMenu);
  document.getElementById('categoryFilter').addEventListener('change', renderMenu);

  /*********** Ø§Ù„Ø³Ù„Ø© ***********/
  function addToCart(itemId) {
    const item = MENU.find(m => m.id == itemId);
    if (!item) return;
    const existing = CART.find(c => c.id == itemId);
    if (existing) {
      existing.qty += 1;
    } else {
      CART.push({
        id: item.id,
        name: item.name,
        price: item.price,
        qty: 1
      });
    }
    renderCart();
    bumpCartAnimation_();
    feedback_(); // Ø±Ø¬Ø§Ø¬ + ØµÙˆØª
  }

  function bumpCartAnimation_() {
    const cartCard = document.getElementById('cartCard');
    cartCard.classList.remove('cart-bump');
    void cartCard.offsetWidth; // Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù†
    cartCard.classList.add('cart-bump');
  }

  // Ø±Ø¬Ø§Ø¬ + ØµÙˆØª Ø¨Ø³ÙŠØ·
  function feedback_() {
    // Ø§Ù‡ØªØ²Ø§Ø²
    if (navigator.vibrate) {
      navigator.vibrate(40);
    }

    // Ù†ØºÙ…Ø© Ù‚ØµÙŠØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Audio (Ø¨Ø¯ÙˆÙ† Ù…Ù„Ù ØµÙˆØª)
    try {
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = feedback_._ctx || new AudioCtx();
      feedback_._ctx = ctx;

      const osc = ctx.createOscillator();
      const gain = ctx.createGain();

      osc.type = 'triangle';
      osc.frequency.value = 900;

      gain.gain.setValueAtTime(0.0001, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);

      osc.connect(gain);
      gain.connect(ctx.destination);

      osc.start();
      osc.stop(ctx.currentTime + 0.2);
    } catch (e) {
      // ØªØ¬Ø§Ù‡Ù„ Ø£ÙŠ Ø®Ø·Ø£ (Ø¨Ø¹Ø¶ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ù‚Ø¯ ØªÙ…Ù†Ø¹ Ø§Ù„ØµÙˆØª)
    }
  }

  function changeQty(itemId, delta) {
    const existing = CART.find(c => c.id == itemId);
    if (!existing) return;
    existing.qty += delta;
    if (existing.qty <= 0) {
      CART = CART.filter(c => c.id != itemId);
    }
    renderCart();
  }

  function renderCart() {
    const cartDiv = document.getElementById('cart-content');
    const totalDiv = document.getElementById('cart-total');

    if (!CART.length) {
      cartDiv.innerHTML = '<div class="cart-empty">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.</div>';
      totalDiv.textContent = '';
      return;
    }

    let html = '';
    let total = 0;
    CART.forEach(item => {
      const line = item.price * item.qty;
      total += line;
      html += `
        <div class="cart-item">
          <div>
            <div>${escapeHtml_(item.name)}</div>
            <div style="font-size:0.8rem; color:#777;">${item.price} Ù„.Ø³ Ã— ${item.qty}</div>
          </div>
          <div class="cart-item-controls">
            <button onclick="changeQty('${item.id}', 1)">+</button>
            <button onclick="changeQty('${item.id}', -1)">-</button>
          </div>
        </div>
      `;
    });

    cartDiv.innerHTML = html;
    totalDiv.textContent = 'Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ' + total + ' Ù„.Ø³';
  }

  /*********** Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ***********/
  async function submitOrder() {
    if (!CART.length) {
      showStatus('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©ØŒ Ø£Ø¶Ù Ø£ØµÙ†Ø§ÙØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹.', false);
      return;
    }

    const customerName = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const address = document.getElementById('address').value.trim();
    const delivery = document.getElementById('delivery').value;
    const notes = document.getElementById('notes').value.trim();

    if (!customerName || !phone) {
      showStatus('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„.', false);
      return;
    }

    const total = CART.reduce((sum, item) => sum + item.price * item.qty, 0);
    const order = {
      customerName,
      phone,
      address,
      delivery,
      notes,
      items: CART,
      total
    };

    showStatus('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...', true);

    try {
      // Ù†Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨ÙˆØ¶Ø¹ no-cors Ù„ØªÙØ§Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø© CORS
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({ action: 'submitOrder', order })
      });

      showStatus(
        'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨. Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ' + total + ' Ù„.Ø³',
        true
      );
      CART = [];
      renderCart();
      document.getElementById('notes').value = '';

      // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¯Ù…
      localStorage.setItem('customerPhone', phone);
      localStorage.setItem('customerName', customerName);
      localStorage.setItem('customerAddress', address);
    } catch (err) {
      showStatus('ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª). Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', false);
    }
  }

  function showStatus(msg, success) {
    const s = document.getElementById('status');
    s.textContent = msg;
    s.className = 'status-message ' + (success ? 'success' : 'error');
  }

  document.getElementById('submitOrderBtn').addEventListener('click', submitOrder);

  /*********** ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨ ***********/
  async function trackOrders() {
    const orderId = document.getElementById('trackOrderId').value.trim();
    const phone = document.getElementById('trackPhone').value.trim();
    const resultDiv = document.getElementById('trackResult');
    resultDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';

    if (!orderId && !phone) {
      resultDiv.textContent = 'Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„.';
      return;
    }

    try {
      const params = new URLSearchParams();
      params.set('action', 'trackOrders');
      if (orderId) params.set('orderId', orderId);
      if (phone) params.set('phone', phone);

      const res = await fetch(API_URL + '?' + params.toString());
      const data = await res.json();
      if (!data.success) throw new Error(data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØªØ¨Ø¹');

      const orders = data.orders || [];
      if (!orders.length) {
        resultDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.';
        return;
      }

      let html = '';
      orders.forEach(o => {
        const badge = getStatusBadge_(o.status);
        html += `
          <div class="track-card">
            <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${o.order_id}</div>
            <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${escapeHtml_(formatDateTime_(o.timestamp))}</div>
            <div><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> <span class="track-status">${badge}</span></div>
            <div><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> ${o.total} Ù„.Ø³</div>
          </div>
        `;
      });

      resultDiv.innerHTML = html;

    } catch (err) {
      resultDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£: ' + err.message;
    }
  }

  function getStatusBadge_(status) {
    const s = status || 'Ø¬Ø¯ÙŠØ¯';
    if (s === 'Ø¬Ø¯ÙŠØ¯') return 'ğŸŸ¢ Ø¬Ø¯ÙŠØ¯';
    if (s === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±') return 'ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±';
    if (s === 'Ø¬Ø§Ù‡Ø²') return 'ğŸ”µ Ø¬Ø§Ù‡Ø²';
    if (s === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…') return 'âœ… ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…';
    return s;
  }

  document.getElementById('trackBtn').addEventListener('click', trackOrders);

  /*********** Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ***********/
  async function adminLogin() {
    const password = document.getElementById('adminPassword').value;
    if (!password) return;
    ADMIN_TOKEN = password; // Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±

    document.getElementById('adminStatus').textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...';
    await loadAdminOrders();
  }

  async function loadAdminOrders() {
    const statusDiv = document.getElementById('adminStatus');
    const listDiv = document.getElementById('adminOrders');
    listDiv.innerHTML = '';

    if (!ADMIN_TOKEN) {
      statusDiv.textContent = 'Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø£ÙˆÙ„Ø§Ù‹.';
      statusDiv.className = 'status-message error';
      return;
    }

    try {
      const params = new URLSearchParams();
      params.set('action', 'getOrders');
      params.set('adminPassword', ADMIN_TOKEN);

      const res = await fetch(API_URL + '?' + params.toString());
      const data = await res.json();
      if (!data.success) {
        statusDiv.textContent = 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.';
        statusDiv.className = 'status-message error';
        return;
      }

      ADMIN_ORDERS = data.orders || [];
      statusDiv.textContent = 'ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + ADMIN_ORDERS.length + ' Ø·Ù„Ø¨.';
      statusDiv.className = 'status-message success';

      renderAdminOrdersList_();
    } catch (err) {
      statusDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ' + err.message;
      statusDiv.className = 'status-message error';
    }
  }

  function renderAdminOrdersList_() {
    const listDiv = document.getElementById('adminOrders');
    const filter = document.getElementById('adminStatusFilter').value;
    listDiv.innerHTML = '';

    if (!ADMIN_ORDERS.length) {
      listDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.';
      return;
    }

    // ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø¯Ù…
    const orders = [...ADMIN_ORDERS].sort(
      (a,b) => new Date(b.timestamp) - new Date(a.timestamp)
    );

    let html = '';
    orders.forEach(o => {
      const status = o.status || 'Ø¬Ø¯ÙŠØ¯';
      if (filter !== 'ALL' && status !== filter) return;
      html += renderAdminOrderRow_(o);
    });

    if (!html) {
      listDiv.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø©.';
    } else {
      listDiv.innerHTML = html;
    }
  }

  function renderAdminOrderRow_(o) {
    const status = o.status || 'Ø¬Ø¯ÙŠØ¯';
    const badgeClass = (s => {
      if (s === 'Ø¬Ø¯ÙŠØ¯') return 'badge-new';
      if (s === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±') return 'badge-preparing';
      if (s === 'Ø¬Ø§Ù‡Ø²') return 'badge-ready';
      if (s === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…') return 'badge-done';
      return 'badge-new';
    })(status);

    const itemsPreview = (() => {
      try {
        const items = JSON.parse(o.itemsJson || '[]');
        return items.map(i => `${i.name} Ã— ${i.qty}`).join('ØŒ ');
      } catch {
        return '';
      }
    })();

    return `
      <div class="admin-order" data-id="${o.order_id}">
        <div class="admin-order-header">
          <div>Ø±Ù‚Ù…: ${o.order_id}</div>
          <div><span class="admin-badge ${badgeClass}">${status}</span></div>
        </div>

        <div class="admin-order-body">
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„Ø§Ø³Ù…:</span>
            <span>${escapeHtml_(o.customerName)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ù‡Ø§ØªÙ:</span>
            <span>${escapeHtml_(o.phone)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
            <span>${escapeHtml_(o.address)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„Ù†ÙˆØ¹:</span>
            <span>${escapeHtml_(o.delivery)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>
            <span>${escapeHtml_(o.notes)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„Ø£ØµÙ†Ø§Ù:</span>
            <span>${escapeHtml_(itemsPreview)}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
            <span>${escapeHtml_(formatDateTime_(o.timestamp))}</span>
          </div>
          <div class="admin-order-body-row">
            <span class="label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
            <span>${o.total} Ù„.Ø³</span>
          </div>
        </div>

        <div class="admin-order-footer">
          <div>
            <select onchange="changeAdminStatus('${o.order_id}', this.value)">
              <option value="Ø¬Ø¯ÙŠØ¯" ${status === 'Ø¬Ø¯ÙŠØ¯' ? 'selected' : ''}>Ø¬Ø¯ÙŠØ¯</option>
              <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±" ${status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</option>
              <option value="Ø¬Ø§Ù‡Ø²" ${status === 'Ø¬Ø§Ù‡Ø²' ? 'selected' : ''}>Ø¬Ø§Ù‡Ø²</option>
              <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…" ${status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
            </select>
          </div>
          <button class="btn btn-ghost" onclick="refreshSingleOrder('${o.order_id}')">ØªØ­Ø¯ÙŠØ«</button>
        </div>
      </div>
    `;
  }

  async function changeAdminStatus(orderId, newStatus) {
    if (!ADMIN_TOKEN) return;
    try {
      await fetch(API_URL, {
        method: 'POST',
        mode: 'no-cors',
        body: JSON.stringify({
          action: 'updateOrderStatus',
          adminPassword: ADMIN_TOKEN,
          orderId,
          newStatus
        })
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù…Ø­Ù„ÙŠ
      const target = ADMIN_ORDERS.find(o => o.order_id === orderId);
      if (target) target.status = newStatus;

      renderAdminOrdersList_();

      document.getElementById('adminStatus').textContent =
        'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ' + orderId + ' Ø¥Ù„Ù‰ "' + newStatus + '".';
      document.getElementById('adminStatus').className = 'status-message success';
    } catch (err) {
      document.getElementById('adminStatus').textContent =
        'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© (ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª).';
      document.getElementById('adminStatus').className = 'status-message error';
    }
  }

  async function refreshSingleOrder(orderId) {
    await loadAdminOrders();
  }

  document.getElementById('adminLoginBtn').addEventListener('click', adminLogin);
  document.getElementById('adminStatusFilter').addEventListener('change', renderAdminOrdersList_);

  /*********** Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ ***********/
  function toggleAiPanel() {
    document.getElementById('aiPanel').classList.toggle('open');
  }

  async function sendAiQuery() {
    const input = document.getElementById('aiInput');
    const text = input.value.trim();
    if (!text) return;
    const body = document.getElementById('aiBody');

    const userMsg = document.createElement('div');
    userMsg.className = 'ai-msg user';
    userMsg.textContent = text;
    body.appendChild(userMsg);

    const botMsg = document.createElement('div');
    botMsg.className = 'ai-msg bot';
    botMsg.textContent = 'Ù„Ø­Ø¸Ø©ØŒ Ø£Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ÙŠÙˆ Ø¹Ù† Ø´ÙŠØ¡ ÙŠÙ†Ø§Ø³Ø¨ Ø°ÙˆÙ‚Ùƒ...';
    body.appendChild(botMsg);

    body.scrollTop = body.scrollHeight;
    input.value = '';

    try {
      const url = API_URL + '?action=aiSuggest&q=' + encodeURIComponent(text);
      const res = await fetch(url);
      const data = await res.json();
      if (!data.success) throw new Error(data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­');

      const suggestions = data.suggestions || [];
      if (!suggestions.length) {
        botMsg.textContent = 'Ù„Ù… Ø£Ø¬Ø¯ Ø´ÙŠØ¦Ø§Ù‹ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ØŒ Ø­Ø§ÙˆÙ„ ÙˆØµÙ Ø·Ù„Ø¨Ùƒ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø£Ø®Ø±Ù‰ ğŸ˜Š';
        return;
      }

      botMsg.textContent = 'Ù‡Ø°Ù‡ Ø£ÙØ¶Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:';
      suggestions.forEach(item => {
        const div = document.createElement('div');
        div.className = 'ai-suggestion';
        div.textContent = `${item.name} (${item.price} Ù„.Ø³)`;
        div.addEventListener('click', () => {
          addToCart(item.id);
        });
        botMsg.appendChild(document.createElement('br'));
        botMsg.appendChild(div);
      });

      body.scrollTop = body.scrollHeight;
    } catch (err) {
      botMsg.textContent = 'ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù‚ØªØ±Ø§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹: ' + err.message;
    }
  }

  document.getElementById('aiButton').addEventListener('click', toggleAiPanel);
  document.getElementById('aiSendBtn').addEventListener('click', sendAiQuery);
  document.getElementById('aiInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendAiQuery();
    }
  });

  /*********** ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© ***********/
  document.addEventListener('DOMContentLoaded', () => {
    const savedPhone = localStorage.getItem('customerPhone') || '';
    const savedName = localStorage.getItem('customerName') || '';
    const savedAddress = localStorage.getItem('customerAddress') || '';
    if (savedPhone) document.getElementById('phone').value = savedPhone;
    if (savedName) document.getElementById('customerName').value = savedName;
    if (savedAddress) document.getElementById('address').value = savedAddress;

    loadMenu();
  });
</script>

</body>
</html>
